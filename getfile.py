import urllib.request as req
import zipfile
from io import BytesIO
import gzip
import bz2

http_proxy = None

def getFile(getfile, unpack=True):
    if http_proxy:
        proxy = req.ProxyHandler({'http': http_proxy, 'https': http_proxy})
        auth = req.HTTPBasicAuthHandler()
        opener = req.build_opener(proxy, auth, req.HTTPHandler)
        req.install_opener(opener)
    response = req.urlopen(getfile)
    data = response
    if unpack:
        if 'gzip' in response.info().get('Content-Type'):
            buf = BytesIO(response.read())
            data = gzip.GzipFile(fileobj=buf)
        elif 'bzip2' in response.info().get('Content-Type'):
            data = BytesIO(bz2.decompress(response.read()))
        elif 'zip' in response.info().get('Content-Type'):
            fzip = zipfile.ZipFile(BytesIO(response.read()), 'r')
            if len(fzip.namelist())>0:
                data=BytesIO(fzip.read(fzip.namelist()[0]))
    return data, response